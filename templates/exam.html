<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Exam Audio Capture</title>
</head>
<body>
  <h1>Exam Voice Answering</h1>
  <button id="recordBtn">Start Recording Answer</button>
  <p id="transcript">Transcript will appear here...</p>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    document.getElementById('recordBtn').onclick = async () => {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
        return;
      }
      const stream = await navigator.mediaDevices.getUserMedia({audio:true});
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = e => {
        audioChunks.push(e.data);
      };

      mediaRecorder.onstop = async e => {
        const blob = new Blob(audioChunks, {'type': 'audio/wav'});
        audioChunks = [];

        const formData = new FormData();
        formData.append('file', blob, 'answer.wav');

        const response = await fetch('/transcribe_audio', {method: 'POST', body: formData});
        const data = await response.json();
        if(data.text){
          document.getElementById('transcript').innerText = 'Transcript: ' + data.text;
          // Send this text as an answer to your backend/exam flow (implement if needed)
        } else if(data.error) {
          document.getElementById('transcript').innerText = 'Error: ' + data.error;
        }
      };

      mediaRecorder.start();

      setTimeout(() => {
        if (mediaRecorder.state === "recording") mediaRecorder.stop();
      }, 5000); // 5 seconds recording duration
    };
  </script>
</body>
</html>
